@if (visible()) { <div class="panel-backdrop" (click)="cerrar()"></div> }
<div class="side-panel" [class.open]="visible()">
  <div class="panel-header">
    <div class="panel-title-wrap">
      <div class="panel-icon"><i class="pi pi-id-card"></i></div>
      <div>
        <h2 class="panel-title">{{ titulo() }}</h2>
        <p class="panel-sub">Cédula, RUC, NIT, DNI, Pasaporte...</p>
      </div>
    </div>
    <button class="close-btn" (click)="cerrar()"><i class="pi pi-times"></i></button>
  </div>

  <div class="panel-body">
    @if (error()) { <div class="panel-error"><i class="pi pi-exclamation-circle"></i><span>{{ error() }}</span></div> }
    <form [formGroup]="form" class="panel-form">
      <div class="form-section">
        <div class="section-label"><i class="pi pi-globe"></i> País (opcional)</div>
        <div class="field">
          <label>País</label>
          <p-select formControlName="paisId" [options]="paisesOptions()" optionLabel="label" optionValue="value"
                    placeholder="Global (todos los países)" styleClass="w-full" [filter]="true" />
        </div>
      </div>

      <div class="form-section">
        <div class="section-label"><i class="pi pi-id-card"></i> Datos</div>
        <div class="form-row">
          <div class="field">
            <label>Código <span class="req">*</span></label>
            <input pInputText formControlName="codigo" placeholder="CED" class="mono-input" />
            @if (invalid('codigo')) { <small class="err">Requerido</small> }
          </div>
          <div class="field col-2">
            <label>Nombre <span class="req">*</span></label>
            <input pInputText formControlName="nombre" placeholder="Cédula de Identidad" />
            @if (invalid('nombre')) { <small class="err">Requerido</small> }
          </div>
        </div>
        <div class="form-row">
          <div class="field">
            <label>Longitud</label>
            <input pInputText type="number" formControlName="longitud" placeholder="10" min="1" />
          </div>
          <div class="field col-2">
            <label>Patrón (Regex)</label>
            <input pInputText formControlName="patron" placeholder="^[0-9]{10}$" class="mono-input" />
          </div>
        </div>
        <div class="field">
          <label>Orden</label>
          <input pInputText type="number" formControlName="orden" placeholder="0" min="0" />
        </div>
      </div>

      <div class="form-section">
        <div class="section-label"><i class="pi pi-check-square"></i> Aplica a</div>
        <div class="checks-row">
          <div class="field-check">
            <p-checkbox formControlName="aplicaPersona" [binary]="true" inputId="aplicaPersona" />
            <label for="aplicaPersona">Persona natural</label>
          </div>
          <div class="field-check">
            <p-checkbox formControlName="aplicaEmpresa" [binary]="true" inputId="aplicaEmpresa" />
            <label for="aplicaEmpresa">Empresa / Jurídica</label>
          </div>
        </div>
      </div>
    </form>
  </div>

  <div class="panel-footer">
    <p-button label="Cancelar" severity="secondary" [outlined]="true" [disabled]="guardando()" (onClick)="cerrar()" styleClass="flex-1" />
    <p-button [label]="esEdicion() ? 'Guardar cambios' : 'Crear tipo'" [icon]="esEdicion() ? 'pi pi-save' : 'pi pi-plus'" [loading]="guardando()" (onClick)="guardar()" styleClass="flex-1" />
  </div>
</div>
