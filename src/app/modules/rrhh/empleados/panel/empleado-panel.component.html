<p-toast position="top-right" />

@if (visible()) { <div class="panel-backdrop" (click)="cerrar()"></div> }

<div class="side-panel wide-panel" [class.open]="visible()">

  <!-- Header -->
  <div class="panel-header">
    <div class="panel-title-wrap">
      <div class="panel-icon">
        <i [class]="esEdicion() ? 'pi pi-user-edit' : 'pi pi-user-plus'"></i>
      </div>
      <div>
        <h2 class="panel-title">{{ titulo() }}</h2>
        <p class="panel-sub">{{ subtitulo() }}</p>
      </div>
    </div>
    <button class="close-btn" (click)="cerrar()"><i class="pi pi-times"></i></button>
  </div>

  <!-- Body -->
  <div class="panel-body">

    @if (error()) {
      <div class="panel-error"><i class="pi pi-exclamation-circle"></i><span>{{ error() }}</span></div>
    }

    <form [formGroup]="form" class="panel-form">

      <!-- ── Sección 1: Datos personales ── -->
      <div class="form-section">
        <div class="section-label"><i class="pi pi-id-card"></i> Datos personales</div>

        <div class="form-row">
          <div class="field">
            <label>Tipo Identificación <span class="req">*</span></label>
            <p-select formControlName="tipoIdentificacion"
              [options]="tipoIdOpts" optionLabel="label" optionValue="value" styleClass="w-full" />
          </div>
          <div class="field">
            <label>N° Identificación <span class="req">*</span></label>
            <input pInputText formControlName="numeroIdentificacion" placeholder="0000000000" />
            @if (invalid('numeroIdentificacion')) { <small class="err">Campo requerido</small> }
            @if (esEdicion()) { <small class="field-hint">No se puede modificar</small> }
          </div>
        </div>

        <div class="form-row">
          <div class="field">
            <label>Nombres <span class="req">*</span></label>
            <input pInputText formControlName="nombres" placeholder="Juan Carlos" />
            @if (invalid('nombres')) { <small class="err">Mínimo 2 caracteres</small> }
          </div>
          <div class="field">
            <label>Apellidos <span class="req">*</span></label>
            <input pInputText formControlName="apellidos" placeholder="Pérez García" />
            @if (invalid('apellidos')) { <small class="err">Mínimo 2 caracteres</small> }
          </div>
        </div>

        <div class="form-row">
          <div class="field">
            <label>Fecha de Nacimiento</label>
            <input pInputText type="date" formControlName="fechaNacimiento" />
          </div>
          <div class="field">
            <label>Género</label>
            <p-select formControlName="genero" [options]="generoOpts" optionLabel="label" optionValue="value"
              placeholder="— Seleccione —" [showClear]="true" styleClass="w-full" />
          </div>
        </div>

        <div class="form-row">
          <div class="field">
            <label>Estado Civil</label>
            <p-select formControlName="estadoCivil" [options]="estadoCivilOpts" optionLabel="label" optionValue="value"
              placeholder="— Seleccione —" [showClear]="true" styleClass="w-full" />
          </div>
          <div class="field">
            <label>Teléfono Celular</label>
            <input pInputText formControlName="telefonoCelular" placeholder="+593 99 999 9999" />
          </div>
        </div>

        <div class="form-row">
          <div class="field">
            <label>Email Personal</label>
            <input pInputText type="email" formControlName="emailPersonal" placeholder="usuario@gmail.com" />
            @if (invalid('emailPersonal')) { <small class="err">Email inválido</small> }
          </div>
          <div class="field">
            <label>Email Corporativo</label>
            <input pInputText type="email" formControlName="emailCorporativo" placeholder="usuario@empresa.com" />
            @if (invalid('emailCorporativo')) { <small class="err">Email inválido</small> }
          </div>
        </div>

        <div class="field">
          <label>Dirección</label>
          <textarea pTextarea formControlName="direccion"
            placeholder="Dirección domiciliaria..." rows="2"
            style="width:100%; resize:vertical;"></textarea>
        </div>
      </div>

      <!-- ── Sección 2: Datos laborales ── -->
      <div class="form-section">
        <div class="section-label"><i class="pi pi-briefcase"></i> Datos laborales</div>

        <div class="form-row">
          <div class="field">
            <label>Departamento</label>
            <p-select formControlName="departamentoId" [options]="departamentosOpts"
              optionLabel="label" optionValue="value"
              placeholder="— Sin asignar —" [showClear]="true" styleClass="w-full" />
          </div>
          <div class="field">
            <label>Puesto</label>
            <p-select formControlName="puestoId" [options]="puestosFiltrados()"
              optionLabel="label" optionValue="value"
              placeholder="— Sin asignar —" [showClear]="true" styleClass="w-full" />
          </div>
        </div>

        <div class="form-row">
          <div class="field">
            <label>Jefe Directo</label>
            <p-select formControlName="jefeDirectoId" [options]="empleadosOpts"
              optionLabel="label" optionValue="value"
              placeholder="— Sin asignar —" [showClear]="true" styleClass="w-full" />
          </div>
          <div class="field">
            <label>Fecha de Ingreso <span class="req">*</span></label>
            <input pInputText type="date" formControlName="fechaIngreso" />
            @if (invalid('fechaIngreso')) { <small class="err">Campo requerido</small> }
          </div>
        </div>

        <div class="form-row">
          <div class="field">
            <label>Tipo de Contrato <span class="req">*</span></label>
            <p-select formControlName="tipoContrato" [options]="contratoOpts"
              optionLabel="label" optionValue="value" styleClass="w-full" />
          </div>
          <div class="field">
            <label>Modalidad de Trabajo <span class="req">*</span></label>
            <p-select formControlName="modalidadTrabajo" [options]="modalidadOpts"
              optionLabel="label" optionValue="value" styleClass="w-full" />
          </div>
        </div>

        <div class="form-row">
          <div class="field">
            <label>Jornada Laboral <span class="req">*</span></label>
            <p-select formControlName="jornadaLaboral" [options]="jornadaOpts"
              optionLabel="label" optionValue="value" styleClass="w-full" />
          </div>
          <div class="field">
            <label>Horas Semanales <span class="req">*</span></label>
            <p-inputnumber formControlName="horasSemanales"
              [min]="1" [max]="60" placeholder="40"
              styleClass="w-full" inputStyleClass="w-full" />
            @if (invalid('horasSemanales')) { <small class="err">Campo requerido</small> }
          </div>
        </div>

        <div class="form-row">
          <div class="field">
            <label>Salario Base (USD) <span class="req">*</span></label>
            <p-inputnumber formControlName="salarioBase"
              mode="currency" currency="USD" locale="es-EC"
              [minFractionDigits]="2" placeholder="0.00"
              styleClass="w-full" inputStyleClass="w-full" />
            @if (invalid('salarioBase')) { <small class="err">Campo requerido</small> }
          </div>
          <div class="field">
            <label>N° Seguro Social</label>
            <input pInputText formControlName="numeroSeguroSocial" placeholder="IESS" />
          </div>
        </div>

        @if (esEdicion()) {
          <div class="field">
            <label>Estado</label>
            <p-select formControlName="estado" [options]="estadoOpts"
              optionLabel="label" optionValue="value" styleClass="w-full" />
          </div>
        }
      </div>

      <!-- ── Sección 3: Datos bancarios ── -->
      <div class="form-section">
        <div class="section-label"><i class="pi pi-wallet"></i> Datos bancarios</div>

        <div class="form-row">
          <div class="field">
            <label>Banco</label>
            <p-select formControlName="bancoId" [options]="bancosOpts()"
              optionLabel="label" optionValue="value"
              placeholder="— Seleccione banco —" [showClear]="true" [filter]="true" styleClass="w-full" />
          </div>
          <div class="field">
            <label>Tipo de Cuenta</label>
            <p-select formControlName="tipoCuenta" [options]="cuentaOpts"
              optionLabel="label" optionValue="value"
              placeholder="— Seleccione —" [showClear]="true" styleClass="w-full" />
          </div>
        </div>

        <div class="field">
          <label>N° Cuenta Bancaria</label>
          <input pInputText formControlName="numeroCuenta" placeholder="000000000000" class="mono-input" />
        </div>
      </div>

    </form>
  </div>

  <!-- Footer -->
  <div class="panel-footer">
    <p-button label="Cancelar" severity="secondary" [outlined]="true"
      [disabled]="cargando()" (onClick)="cerrar()" styleClass="flex-1" />
    <p-button
      [label]="esEdicion() ? 'Guardar cambios' : 'Crear empleado'"
      [icon]="esEdicion() ? 'pi pi-save' : 'pi pi-user-plus'"
      [loading]="cargando()" (onClick)="guardar()" styleClass="flex-1" />
  </div>

</div>